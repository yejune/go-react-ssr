# go-react-ssr 프로젝트 분석 보고서

## 1. 아키텍처 개요

```
┌─────────────────────────────────────────────────────────────────┐
│                        HTTP Request                              │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Engine.RenderRoute()                          │
│                      (render.go:24)                              │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      renderTask.Start()                          │
│                    (rendertask.go:35)                            │
│  ┌────────────────────┐    ┌────────────────────┐               │
│  │  Server Render     │    │  Client Render     │  (병렬 실행)   │
│  │  (goroutine)       │    │  (goroutine)       │               │
│  └────────────────────┘    └────────────────────┘               │
└─────────────────────────────────────────────────────────────────┘
                              │
            ┌─────────────────┴─────────────────┐
            ▼                                   ▼
┌───────────────────────┐           ┌───────────────────────┐
│   esbuild (Bundle)    │           │   esbuild (Bundle)    │
│   Server Build        │           │   Client Build        │
│   (reactbuilder)      │           │   (reactbuilder)      │
└───────────────────────┘           └───────────────────────┘
            │
            ▼
┌───────────────────────┐
│   JS Runtime Pool     │  ◀── V8 또는 QuickJS
│   renderToString()    │
└───────────────────────┘
            │
            ▼
┌───────────────────────┐
│   HTML Template       │
│   + Hydration JS      │
└───────────────────────┘
```

## 2. 성능 병목 지점 분석

### 병목 #1: esbuild 번들링 (캐시 미스 시)

**위치:** `internal/reactbuilder/build.go:81-105`

**문제점:**
- 캐시 미스 시 esbuild 번들링 실행 (100-500ms)
- 첫 요청 시 발생

**완화:** 인메모리 캐시 (`internal/cache/manager.go`)로 반복 요청 최적화

### 병목 #2: 인메모리 캐시의 한계

**위치:** `internal/cache/manager.go`

**문제점:**
- 프로세스 재시작 시 캐시 소멸
- 수평 확장(다중 인스턴스) 시 캐시 공유 불가
- 메모리 제한 없음 (OOM 위험)
- LRU/TTL 정책 없음

### 해결됨: JS 런타임 풀링

**이전 문제:** 매 요청마다 QuickJS 런타임 생성/파괴

**현재 해결:** `internal/jsruntime/` 패키지에서 런타임 풀링 구현

```go
pool := jsruntime.NewPool(jsruntime.PoolConfig{
    PoolSize: 10,  // 풀 크기
})
result, err := pool.Execute(js)  // 풀에서 런타임 가져와 실행
```

## 3. 벤치마크 결과 (Apple M4)

```
                          QuickJS      V8         개선율
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Simple (풀링)              225μs       199μs      +12%
Complex (풀링)             234μs       137μs      +70%
풀링 없음                   312μs       581μs      풀링 필수
병렬 처리 (10 cores)        49μs        26μs      +85%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 4. Next.js와 비교

| 항목 | go-react-ssr | Next.js |
|------|-------------|---------|
| **JS 런타임** | V8/QuickJS 선택 가능 | V8 |
| **빌드 시스템** | esbuild | SWC/Turbopack |
| **캐싱** | 인메모리 only | ISR, 파일 캐시, CDN |
| **스트리밍 SSR** | 미지원 | React 18 Suspense 지원 |
| **정적 생성 (SSG)** | 미지원 | 완전 지원 |
| **Edge Runtime** | 미지원 | 지원 |
| **데이터 페칭** | 수동 props 전달 | getServerSideProps 등 |
| **라우팅** | 없음 (프레임워크 의존) | 파일 기반 라우팅 |
| **이미지 최적화** | 미지원 | next/image |
| **메모리 사용량** | 낮음 (Go 기반) | 높음 (Node.js) |
| **콜드 스타트** | 빠름 | 느림 |
| **의존성** | 2개 (프로덕션) | 수백 개 |

### 성능 예상 비교

| 메트릭 | go-react-ssr (V8) | Next.js |
|--------|-------------------|---------|
| 첫 요청 (캐시 미스) | 150-400ms | 50-150ms |
| 캐시 히트 | 10-25ms | 5-20ms |
| 메모리 (1000 동시 연결) | ~100MB | ~500MB+ |
| 처리량 (req/s) | 200-500 | 500-2000 |

## 5. 프로덕션 적합성 평가

### 적합한 경우

1. **Go 백엔드와 통합이 필수인 경우**
   - 기존 Go 마이크로서비스에 SSR 추가
   - Node.js 인프라를 원하지 않는 경우

2. **단순한 페이지/컴포넌트**
   - 정적 콘텐츠 위주
   - 복잡한 인터랙션이 없는 경우

3. **낮은~중간 트래픽 환경**
   - 내부 도구, 관리자 대시보드
   - B2B 애플리케이션
   - 일 10만 요청 이하

4. **메모리 제약 환경**
   - 임베디드 시스템
   - 저사양 서버

### 부적합한 경우

1. **고트래픽 서비스** (일 100만+ 요청) - Next.js 권장
2. **복잡한 React 앱** - 스트리밍 SSR 필요
3. **SEO 중요한 사이트** - SSG/ISR 필요
4. **팀에 Node.js 경험이 있는 경우** - Next.js가 더 생산적

## 6. 현재 의존성

### 프로덕션 빌드 (`-tags=prod`)

```
github.com/evanw/esbuild           # 번들러 (필수)
github.com/buke/quickjs-go         # 또는 rogchap.com/v8go
```

**총 2개 의존성**

### 개발 빌드

```
github.com/evanw/esbuild           # 번들러
github.com/buke/quickjs-go         # QuickJS 런타임
github.com/fsnotify/fsnotify       # 파일 감시
github.com/gorilla/websocket       # Hot reload
github.com/tkrajina/typescriptify  # 타입 생성
```

**총 5개 의존성**

## 7. 남은 개선사항

### 프로덕션 체크리스트

- [x] JS 런타임 풀링
- [x] V8 런타임 지원
- [x] build tag로 의존성 분리
- [ ] 에러 핸들링 강화 (panic recovery)
- [ ] 메트릭/모니터링 추가
- [ ] graceful shutdown 구현
- [ ] 캐시 만료 정책 (LRU/TTL)
- [ ] 디스크 캐시 옵션
- [ ] 헬스체크 엔드포인트

### 향후 개선 가능

- [ ] 스트리밍 SSR 지원
- [ ] 사전 빌드 (SSG 유사)
- [ ] Redis/분산 캐시 옵션
- [ ] Edge 런타임 지원

## 8. 결론

### 총평: 프로덕션 사용 가능 (조건부)

**강점:**
- Go 생태계 통합
- 낮은 메모리 사용량
- 단순한 API
- 최소 의존성 (프로덕션 2개)
- V8 런타임으로 고성능

**약점:**
- Next.js 대비 50-80% 성능
- 스트리밍 SSR 미지원
- 분산 캐시 미지원

### 추천

| 시나리오 | 추천 |
|---------|------|
| Go 필수 + 단순~중간 SSR | **이 프로젝트 (V8 빌드)** |
| Go 필수 + 복잡한 앱 | 별도 Node.js SSR 서버 |
| 신규 프로젝트 | Next.js 또는 Remix |
